<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="css/Admin.css" />
    <title>Admin Dashboard</title>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-cogs"></i> Admin</h2>
        <ul>
            <li><a href="#productos"><i class="fas fa-box"></i> Productos</a></li>
            <li><a href="#pedidos"><i class="fas fa-shopping-cart"></i> Pedidos</a></li>
            <li><a href="#pagos"><i class="fas fa-credit-card"></i> Pagos</a></li>
            <li><a href="#ventas"><i class="fas fa-chart-line"></i> Ventas</a></li>
            <li><a href="#proveedores"><i class="fas fa-building"></i> Proveedores</a></li>
            <li><a href="#gastos"><i class="fas fa-money-bill-wave"></i> Gastos</a></li>
            <li><a href="#compras"><i class="fas fa-truck"></i> Compras</a></li>
            <li><a href="#usuarios"><i class="fas fa-users"></i> Usuarios</a></li>
            <li><a href="#casos-soporte"><i class="fas fa-headset"></i> Casos de Soporte</a></li>
            <li><a href="#actividades"><i class="fas fa-tasks"></i> Actividades</a></li>
            <li><a href="#oportunidades"><i class="fas fa-bullseye"></i> Oportunidades</a></li>
            <li><a href="#interacciones"><i class="fas fa-comments"></i> Interacciones</a></li>
            <li><a href="#metricas-crm"><i class="fas fa-chart-bar"></i> Métricas CRM</a></li>
            <li> <a href="analytics.html"> <i class="fas fa-chart-line"></i> Visual Analytics</a></li>
            <button id="btnCerrarSesion" class="btn-add">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </button>
        </ul>
    </div>

    <div class="main-content">
        <header>
            <h1>Panel de Administración</h1>
            <p class="mb-0">Bienvenido al sistema de gestión</p>
        </header>

        <!-- Sección Productos (sin cambios) -->
        <section id="productos" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Gestión de Productos</h2>
                <button class="btn-add" id="btnAgregarProducto">
                    <i class="fas fa-plus"></i> Agregar Producto
                </button>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th><th>Nombre</th><th>Imagen</th><th>Valor</th><th>Cantidad</th>
                            <th>Información</th><th>Fecha</th><th>Impuesto</th><th>Costo</th>
                            <th>Proveedor</th><th>Retefuente</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProductos"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Pedidos (sin cambios) -->
        <section id="pedidos" class="card seccion-content" style="display:none;">
            <h2>Gestión de Pedidos</h2>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th><th>Estado</th><th>Cliente</th><th>Correo</th><th>Dirección</th>
                            <th>Productos</th><th>Fecha</th><th>Actualización</th><th>Subtotal</th>
                            <th>Descuentos</th><th>Impuestos</th><th>Total</th><th>Usuario</th>
                        </tr>
                    </thead>
                    <tbody id="tablaPedidos"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Pagos (sin cambios) -->
        <section id="pagos" class="card seccion-content" style="display:none;">
            <h2>Pagos Registrados</h2>
            <p id="countPagos"></p>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Dirección</th><th>Forma Pago</th><th>Teléfono</th>
                            <th>Correo</th><th>Subtotal</th><th>Descuentos</th><th>Impuestos</th><th>Total</th>
                            <th>Fecha</th><th>Estado</th><th>Usuario</th><th>Pedido</th><th>Referencia</th><th>Notas</th>
                        </tr>
                    </thead>
                    <tbody id="tablaPagos"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Proveedores (sin cambios) -->
        <section id="proveedores" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-building"></i> Gestión de Proveedores</h2>
                <button class="btn-add" id="btnAgregarProveedor">
                    <i class="fas fa-plus"></i> Agregar Proveedor
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Nombre</th><th>NIT</th><th>Dirección</th>
                            <th>Contacto</th><th>% Retención</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProveedores"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Ventas (sin cambios significativos) -->
        <section id="ventas" class="card seccion-content" style="display:none;">
            <div class="ventas-header">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-chart-line"></i> Gestión de Ventas</h2>
                    <div class="ventas-actions">
                        <button class="btn btn-outline-success" id="btnExportarVentas">
                            <i class="fas fa-download"></i> Exportar CSV
                        </button>
                    </div>
                </div>
                <div id="estadisticasGenerales" class="estadisticas-container mb-4"></div>
                <div class="filtros-ventas card mb-4">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-filter"></i> Filtrar Ventas por Fecha</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fechaInicio"><i class="fas fa-calendar-alt"></i> Fecha Inicio</label>
                                    <input type="date" class="form-control" id="fechaInicio" name="fechaInicio">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fechaFin"><i class="fas fa-calendar-alt"></i> Fecha Fin</label>
                                    <input type="date" class="form-control" id="fechaFin" name="fechaFin">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <div class="d-flex">
                                        <button type="button" class="btn btn-primary mr-2" id="btnBuscarFechas">
                                            <i class="fas fa-search"></i> Buscar
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" id="btnLimpiarFiltros">
                                            <i class="fas fa-eraser"></i> Limpiar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="estadisticasPeriodo" style="display: none;"></div>
                    </div>
                </div>
            </div>
            <div id="cargandoVentas" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Cargando...</span>
                </div>
                <p class="mt-2">Cargando ventas...</p>
            </div>
            <div class="table-responsive">
                <table class="table table-hover ventas-table">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Pedido</th><th>Productos</th><th>Subtotal</th>
                            <th>Descuentos</th><th>Impuestos</th><th>Total</th><th>Estado</th><th>Fecha</th>
                            <th>Costo Total</th><th>Utilidad</th><th>Retención</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaVentas"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Gastos (sin cambios) -->
        <section id="gastos" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-money-bill-wave"></i> Gestión de Gastos</h2>
                <button class="btn-add" id="btnAgregarGasto">
                    <i class="fas fa-plus"></i> Agregar Gasto
                </button>
            </div>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                            </div>
                            <input type="text" class="form-control" id="buscarGasto" placeholder="Buscar gastos...">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <select class="form-control" id="filtroCategoria">
                            <option value="">Todas las categorías</option>
                            <option value="publicidad">Publicidad</option>
                            <option value="Mantener">Mantener</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="estadisticasGastos" class="estadisticas-container mb-4"></div>
            <div id="cargandoGastos" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Cargando...</span>
                </div>
                <p class="mt-2">Cargando gastos...</p>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Descripción</th><th>Monto</th><th>Categoría</th>
                            <th>Producto</th><th>Fecha</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaGastos"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Compras (sin cambios) -->
        <section id="compras" class="card seccion-content" style="display:none;">
            <div class="compras-header">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-shopping-cart"></i> Gestión de Compras</h2>
                    <div class="compras-actions">
                        <button class="btn-add" id="btnAgregarCompra">
                            <i class="fas fa-plus"></i> Agregar Compra
                        </button>
                        <button class="btn btn-outline-success" id="btnExportarCompras">
                            <i class="fas fa-download"></i> Exportar CSV
                        </button>
                    </div>
                </div>
                <div id="estadisticasCompras" class="estadisticas-container mb-4"></div>
                <div class="filtros-compras card mb-4">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-filter"></i> Filtrar Compras</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="filtroProveedorCompras">
                                        <i class="fas fa-building"></i> Proveedor
                                    </label>
                                    <select class="form-control" id="filtroProveedorCompras">
                                        <option value="">Todos los proveedores</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="fechaInicioCompras">
                                        <i class="fas fa-calendar-alt"></i> Fecha Inicio
                                    </label>
                                    <input type="date" class="form-control" id="fechaInicioCompras">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="fechaFinCompras">
                                        <i class="fas fa-calendar-alt"></i> Fecha Fin
                                    </label>
                                    <input type="date" class="form-control" id="fechaFinCompras">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <div class="d-flex">
                                        <button type="button" class="btn btn-primary mr-2" id="btnBuscarFechasCompras">
                                            <i class="fas fa-search"></i> Buscar
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" id="btnLimpiarFiltrosCompras">
                                            <i class="fas fa-eraser"></i> Limpiar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="estadisticasPeriodoCompras" style="display: none;"></div>
                    </div>
                </div>
            </div>
            <div id="cargandoCompras" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Cargando...</span>
                </div>
                <p class="mt-2">Cargando compras...</p>
            </div>
            <div class="table-responsive">
                <table class="table table-hover compras-table">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Proveedor</th><th>Fecha</th><th>Subtotal</th>
                            <th>Retención</th><th>Total</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCompras"></tbody>
                </table>
            </div>
            <div id="paginacionCompras" class="mt-4"></div>
        </section>

        <!-- ============================================= -->
        <!-- SECCIONES CRM - CORREGIDAS -->
        <!-- ============================================= -->

        <!-- Sección Usuarios -->
        <section id="usuarios" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-users"></i> Gestión de Usuarios</h2>
                <button class="btn-add" id="btnAgregarUsuario">
                    <i class="fas fa-plus"></i> Agregar Usuario
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Cédula</th><th>Nombre</th><th>Correo</th><th>Teléfono</th>
                            <th>Rol</th><th>Empresa</th><th>Fecha Creación</th><th>Estado</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaUsuarios"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Casos de Soporte -->
        <section id="casos-soporte" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-headset"></i> Gestión de Casos de Soporte</h2>
                <button class="btn-add" id="btnAgregarCasoSoporte">
                    <i class="fas fa-plus"></i> Agregar Caso
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Asunto</th><th>Descripción</th><th>Prioridad</th>
                            <th>Estado</th><th>Fecha Creación</th><th>Fecha Resolución</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCasosSoporte"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Actividades -->
        <section id="actividades" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-tasks"></i> Gestión de Actividades</h2>
                <button class="btn-add" id="btnAgregarActividad">
                    <i class="fas fa-plus"></i> Agregar Actividad
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Tipo</th><th>Fecha Programada</th><th>Estado</th>
                            <th>Usuario Asignado</th><th>Cliente</th><th>Notas</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaActividades"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Oportunidades -->
        <section id="oportunidades" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-bullseye"></i> Gestión de Oportunidades</h2>
                <button class="btn-add" id="btnAgregarOportunidad">
                    <i class="fas fa-plus"></i> Agregar Oportunidad
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Título</th><th>Valor Estimado</th>
                            <th>Etapa</th><th>Probabilidad</th><th>Fecha Creación</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaOportunidades"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Interacciones -->
        <section id="interacciones" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-comments"></i> Gestión de Interacciones</h2>
                <button class="btn-add" id="btnAgregarInteraccion">
                    <i class="fas fa-plus"></i> Agregar Interacción
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Tipo</th><th>Fecha</th>
                            <th>Descripción</th><th>Usuario</th><th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaInteracciones"></tbody>
                </table>
            </div>
        </section>

        <!-- Sección Métricas CRM -->
        <section id="metricas-crm" class="card seccion-content" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-chart-bar"></i> Métricas del CRM</h2>
                <button class="btn btn-primary" id="btnActualizarMetricas">
                    <i class="fas fa-sync-alt"></i> Actualizar Métricas
                </button>
            </div>

            <!-- Dashboard CRM -->
            <div class="row mb-4">
                <div class="col-12">
                    <h4><i class="fas fa-tachometer-alt"></i> Dashboard CRM</h4>
                    <div class="row" id="dashboardCRM"></div>
                </div>
            </div>

            <!-- Métricas Principales -->
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-exchange-alt"></i> Tasa de Conversión</h5>
                        </div>
                        <div class="card-body text-center" id="tasaConversion"></div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-smile"></i> Satisfacción del Cliente</h5>
                        </div>
                        <div class="card-body text-center" id="satisfaccionCliente"></div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-user-friends"></i> Retención de Clientes</h5>
                        </div>
                        <div class="card-body text-center" id="retencionClientes"></div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fas fa-chart-line"></i> Churn Rate</h5>
                        </div>
                        <div class="card-body text-center" id="churnRate"></div>
                    </div>
                </div>
            </div>

            <!-- Búsqueda Global CRM -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="fas fa-search"></i> Búsqueda Global CRM</h5>
                </div>
                <div class="card-body">
                    <div class="input-group">
                        <input type="text" class="form-control" id="terminoBusquedaCRM"
                            placeholder="Buscar en todo el CRM...">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="button" id="btnBuscarCRM">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                    </div>
                    <div id="resultadosBusquedaCRM" class="mt-3"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- ============================================= -->
    <!-- MODALES CRM - COMPLETAMENTE CORREGIDOS -->
    <!-- ============================================= -->

    
<!-- CORRECCIÓN: Solo la sección de modales CRM del admin.html -->
<!-- Reemplaza los modales CRM existentes con estos corregidos -->

<!-- Modal Agregar/Editar Usuario -->
<div class="modal fade" id="modalUsuario" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalUsuarioLabel">
                    <i class="fas fa-user-plus"></i> Agregar Usuario
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formUsuario">
                    <input type="hidden" id="idUsuario" name="idUsuario">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="cedula">Cédula *</label>
                                <input type="text" class="form-control" id="cedula" name="cedula" required>
                            </div>
                            <div class="form-group">
                                <label for="nombre">Nombre *</label>
                                <input type="text" class="form-control" id="nombre" name="nombre" required>
                            </div>
                            <div class="form-group">
                                <label for="correo">Correo *</label>
                                <input type="email" class="form-control" id="correo" name="correo" required>
                            </div>
                            <div class="form-group">
                                <label for="telefono">Teléfono</label>
                                <input type="text" class="form-control" id="telefono" name="telefono">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="password">Contraseña *</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                                <small class="form-text text-muted">Deje en blanco para mantener la contraseña actual al editar</small>
                            </div>
                            <div class="form-group">
                                <label for="rol">Rol *</label>
                                <select class="form-control" id="rol" name="rol" required>
                                    <option value="admin">Administrador</option>
                                    <option value="empleado">Empleado</option>
                                    <option value="cliente">Cliente</option>
                                    <option value="empresa">Empresa</option>
                                    <option value="crm">crm</option>
                                </select>
                            </div>
                            <div class="form-group" id="grupoEmpresa" style="display:none;">
                                <label for="empresa_trabaja">Empresa donde trabaja</label>
                                <input type="text" class="form-control" id="empresa_trabaja" name="empresa_trabaja" placeholder="Nombre de la empresa">
                                <small class="form-text text-muted">Requerido para empleados y empresas</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="direccion">Dirección</label>
                        <textarea class="form-control" id="direccion" name="direccion" rows="2"></textarea>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Los campos marcados con (*) son obligatorios.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarUsuario">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar/Editar Interacción - CORREGIDO -->
<div class="modal fade" id="modalInteraccion" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title" id="modalInteraccionLabel">
                    <i class="fas fa-comments"></i> Agregar Interacción
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formInteraccion">
                    <input type="hidden" id="id_interaccion" name="id_interaccion">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_clienteInteraccion">Cliente *</label>
                                <select class="form-control" id="id_clienteInteraccion" name="id_cliente" >
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tipo_interaccion">Tipo de Interacción *</label>
                                <select class="form-control" id="tipo_interaccion" name="tipo_interaccion" required>
                                    <option value="Llamada">Llamada</option>
                                    <option value="Email">Email</option>
                                    <option value="Reunión">Reunión</option>
                                    <option value="Chat">Chat</option>
                                    <option value="Visita">Visita</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fecha_interaccion">Fecha Interacción *</label>
                                <input type="datetime-local" class="form-control" id="fecha_interaccion" name="fecha_interaccion" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_usuarioInteraccion">Usuario</label>
                                <select class="form-control" id="id_usuarioInteraccion" name="id_usuario">
                                    <option value="">Seleccionar usuario...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="descripcionInteraccion">Descripción</label>
                        <textarea class="form-control" id="descripcionInteraccion" name="descripcion" rows="4"></textarea>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Los campos marcados con (*) son obligatorios.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarInteraccion">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar/Editar Caso de Soporte -->
<div class="modal fade" id="modalCasoSoporte" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="modalCasoSoporteLabel">
                    <i class="fas fa-headset"></i> Agregar Caso de Soporte
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formCasoSoporte">
                    <input type="hidden" id="id_caso" name="id_caso">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_cliente">Cliente *</label>
                                <select class="form-control" id="id_cliente" name="id_cliente" required>
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="asunto">Asunto *</label>
                                <input type="text" class="form-control" id="asunto" name="asunto" required>
                            </div>
                            <div class="form-group">
                                <label for="prioridad">Prioridad</label>
                                <select class="form-control" id="prioridad" name="prioridad">
                                    <option value="Baja">Baja</option>
                                    <option value="Media">Media</option>
                                    <option value="Alta">Alta</option>
                                    <option value="Crítica">Crítica</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="estado">Estado</label>
                                <select class="form-control" id="estado" name="estado">
                                    <option value="Abierto">Abierto</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Resuelto">Resuelto</option>
                                    <option value="Cerrado">Cerrado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fecha_resolucion">Fecha Resolución</label>
                                <input type="datetime-local" class="form-control" id="fecha_resolucion" name="fecha_resolucion">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="descripcion">Descripción *</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="4" required></textarea>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Los campos marcados con (*) son obligatorios.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarCasoSoporte">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar/Editar Actividad -->
<div class="modal fade" id="modalActividad" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title" id="modalActividadLabel">
                    <i class="fas fa-tasks"></i> Agregar Actividad
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formActividad">
                    <input type="hidden" id="id_actividad" name="id_actividad">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="tipo_actividad">Tipo de Actividad *</label>
                                <select class="form-control" id="tipo_actividad" name="tipo_actividad" required>
                                    <option value="Llamada">Llamada</option>
                                    <option value="Reunión">Reunión</option>
                                    <option value="Email">Email</option>
                                    <option value="Tarea">Tarea</option>
                                    <option value="Seguimiento">Seguimiento</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fecha_programada">Fecha Programada *</label>
                                <input type="datetime-local" class="form-control" id="fecha_programada" name="fecha_programada" required>
                            </div>
                            <div class="form-group">
                                <label for="id_usuario_asignado">Usuario Asignado *</label>
                                <select class="form-control" id="id_usuario_asignado" name="id_usuario_asignado" required>
                                    <option value="">Seleccionar usuario...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="estadoActividad">Estado</label>
                                <select class="form-control" id="estadoActividad" name="estado">
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Completada">Completada</option>
                                    <option value="Cancelada">Cancelada</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="id_clienteActividad">Cliente</label>
                                <select class="form-control" id="id_clienteActividad" name="id_cliente">
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notas">Notas</label>
                        <textarea class="form-control" id="notas" name="notas" rows="4"></textarea>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Los campos marcados con (*) son obligatorios.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarActividad">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar/Editar Oportunidad -->
<div class="modal fade" id="modalOportunidad" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="modalOportunidadLabel">
                    <i class="fas fa-bullseye"></i> Agregar Oportunidad
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formOportunidad">
                    <input type="hidden" id="id_oportunidad" name="id_oportunidad">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_clienteOportunidad">Cliente *</label>
                                <select class="form-control" id="id_clienteOportunidad" name="id_cliente" required>
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="titulo">Título *</label>
                                <input type="text" class="form-control" id="titulo" name="titulo" required>
                            </div>
                            <div class="form-group">
                                <label for="valor_estimado">Valor Estimado</label>
                                <input type="number" class="form-control" id="valor_estimado" name="valor_estimado" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="etapa">Etapa</label>
                                <select class="form-control" id="etapa" name="etapa">
                                    <option value="Prospección">Prospección</option>
                                    <option value="Calificación">Calificación</option>
                                    <option value="Propuesta">Propuesta</option>
                                    <option value="Negociación">Negociación</option>
                                    <option value="Cierre">Cierre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="probabilidad">Probabilidad (%)</label>
                                <input type="number" class="form-control" id="probabilidad" name="probabilidad" min="0" max="100" step="1">
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Los campos marcados con (*) son obligatorios.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarOportunidad">Guardar</button>
            </div>
        </div>
    </div>
</div>
    
    <!-- MODALES ADICIONALES (mantener los existentes sin cambios) -->
    <!-- Aquí van los modales de Productos, Proveedores, Gastos, Compras, etc. -->
    <!-- Modal para Detalle de Venta -->

    <!-- Modal Agregar Producto -->
    <div class="modal fade" id="modalAgregarProducto" tabindex="-1" role="dialog"
        aria-labelledby="modalAgregarProductoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAgregarProductoLabel">
                        <i class="fas fa-plus-circle"></i> Agregar Nuevo Producto
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarProducto">
                        <div class="row">
                            <!-- Columna Izquierda -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nombreProducto">
                                        <i class="fas fa-tag"></i> Nombre del Producto *
                                    </label>
                                    <input type="text" class="form-control" id="nombreProducto" name="nombreProducto"
                                        placeholder="Ingrese el nombre del producto" required />
                                    <small class="form-text text-muted">Nombre descriptivo del producto</small>
                                </div>

                                <div class="form-group">
                                    <label for="valor">
                                        <i class="fas fa-dollar-sign"></i> Precio *
                                    </label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="number" class="form-control" id="valor" name="valor"
                                            placeholder="0.00" min="0" step="0.01" required />
                                    </div>
                                    <small class="form-text text-muted">Precio en pesos colombianos</small>
                                </div>

                                <div class="form-group">
                                    <label for="cantidad">
                                        <i class="fas fa-boxes"></i> Cantidad en Stock *
                                    </label>
                                    <input type="number" class="form-control" id="cantidad" name="cantidad"
                                        placeholder="0" min="0" required />
                                    <small class="form-text text-muted">Cantidad disponible en inventario</small>
                                </div>
                            </div>

                            <!-- Columna Derecha -->
                            <div class="col-md-6">
                                <!-- Selector de imagen mejorado -->
                                <div class="form-group">
                                    <label for="imagen">
                                        <i class="fas fa-image"></i> Imagen del Producto *
                                    </label>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="imagen" name="imagen"
                                            accept="image/*" required />
                                        <label class="custom-file-label" for="imagen">Seleccionar imagen...</label>
                                    </div>
                                    <small class="form-text text-muted">Seleccione una imagen (JPG, PNG, GIF,
                                        WEBP)</small>

                                    <!-- Preview de la imagen -->
                                    <div class="mt-3" id="imagenPreview" style="display: none">
                                        <img id="previewImg" src="" alt="Preview" class="img-thumbnail"
                                            style="max-height: 150px; max-width: 100%" />
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <strong>Archivo seleccionado:</strong>
                                                <span id="nombreArchivo"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="informacion">
                                        <i class="fas fa-info-circle"></i> Información del
                                        Producto *
                                    </label>
                                    <textarea class="form-control" id="informacion" name="informacion" rows="6"
                                        placeholder="Ingrese la información detallada del producto..."
                                        required></textarea>
                                    <small class="form-text text-muted">Descripción completa del producto,
                                        características,
                                        especificaciones, etc.</small>
                                </div>
                            </div>
                        </div>

                        <!-- Información adicional -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Información:</strong> Los campos marcados con (*)
                                    son obligatorios. La fecha de creación y porcentaje de
                                    impuesto se asignarán automáticamente.
                                </div>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="limpiarFormulario()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Guardar Producto
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Actualizar Producto -->
    <div class="modal fade" id="modalActualizarProducto" tabindex="-1" role="dialog"
        aria-labelledby="modalActualizarProductoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalActualizarProductoLabel">
                        <i class="fas fa-edit"></i> Actualizar Producto
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formActualizarProducto">
                        <!-- Campo oculto para el ID del producto -->
                        <input type="hidden" id="idProductoActualizar" name="idProducto">


                        <div class="row">
                            <!-- Columna Izquierda -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nombreProductoActualizar">
                                        <i class="fas fa-tag"></i> Nombre del Producto *
                                    </label>
                                    <input type="text" class="form-control" id="nombreProductoActualizar"
                                        name="nombreProducto" placeholder="Ingrese el nombre del producto" required />
                                    <small class="form-text text-muted">Nombre descriptivo del producto</small>
                                </div>

                                <div class="form-group">
                                    <label for="valorActualizar">
                                        <i class="fas fa-dollar-sign"></i> Precio *
                                    </label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="number" class="form-control" id="valorActualizar" name="valor"
                                            placeholder="0.00" min="0" step="0.01" required />
                                    </div>
                                    <small class="form-text text-muted">Precio en pesos colombianos</small>
                                </div>

                                <div class="form-group">
                                    <label for="cantidadActualizar">
                                        <i class="fas fa-boxes"></i> Cantidad en Stock *
                                    </label>
                                    <input type="number" class="form-control" id="cantidadActualizar" name="cantidad"
                                        placeholder="0" min="0" required />
                                    <small class="form-text text-muted">Cantidad disponible en inventario</small>
                                </div>
                            </div>

                            <!-- Columna Derecha -->
                            <div class="col-md-6">
                                <!-- Imagen actual -->
                                <div class="form-group">
                                    <label>
                                        <i class="fas fa-image"></i> Imagen Actual
                                    </label>
                                    <div class="current-image-container">
                                        <img id="imagenActual" src="" alt="Imagen actual" class="current-image" />
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <strong>Archivo actual:</strong>
                                                <span id="nombreImagenActual"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nueva imagen (opcional) -->
                                <div class="form-group">
                                    <label for="imagenActualizar">
                                        <i class="fas fa-upload"></i> Cambiar Imagen (Opcional)
                                    </label>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="imagenActualizar" name="imagen"
                                            accept="image/*" />
                                        <label class="custom-file-label" for="imagenActualizar">Seleccionar nueva
                                            imagen...</label>
                                    </div>
                                    <small class="form-text text-muted">Deje vacío para mantener la imagen
                                        actual</small>

                                    <!-- Preview de la nueva imagen -->
                                    <div class="mt-3" id="imagenPreviewActualizar" style="display: none">
                                        <div class="alert alert-info">
                                            <strong>Nueva imagen seleccionada:</strong>
                                        </div>
                                        <img id="previewImgActualizar" src="" alt="Preview" class="preview-image" />
                                        <div class="mt-2">
                                            <small class="text-success">
                                                <strong>Nuevo archivo:</strong>
                                                <span id="nombreArchivoActualizar"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="informacionActualizar">
                                        <i class="fas fa-info-circle"></i> Información del Producto *
                                    </label>
                                    <textarea class="form-control" id="informacionActualizar" name="informacion"
                                        rows="6" placeholder="Ingrese la información detallada del producto..."
                                        required></textarea>
                                    <small class="form-text text-muted">Descripción completa del producto,
                                        características, especificaciones, etc.</small>
                                </div>
                            </div>
                        </div>

                        <!-- Información adicional -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Importante:</strong>
                                    Si no selecciona una nueva imagen, se mantendrá la imagen actual del producto.
                                    Los campos marcados con (*) son obligatorios.
                                </div>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="form-actions">
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                                <button type="button" class="btn btn-warning btn-lg"
                                    onclick="limpiarFormularioActualizar()">
                                    <i class="fas fa-undo"></i> Restablecer
                                </button>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-save"></i> Actualizar Producto
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalDetalleVenta" tabindex="-1" role="dialog" aria-labelledby="modalDetalleVentaLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalDetalleVentaLabel">
                        <i class="fas fa-receipt"></i> Detalle de Venta
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="contenidoDetalleVenta">
                    <!-- El contenido se cargará dinámicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Cambiar Estado de Venta -->
    <div class="modal fade" id="modalCambiarEstado" tabindex="-1" role="dialog"
        aria-labelledby="modalCambiarEstadoLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="modalCambiarEstadoLabel">
                        <i class="fas fa-edit"></i> Cambiar Estado de Venta
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="contenidoCambiarEstado">
                    <!-- El contenido se cargará dinámicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!--Modal gastos-->
    <!-- Modal Agregar Gasto -->
    <div class="modal fade" id="modalAgregarGasto" tabindex="-1" role="dialog" aria-labelledby="modalAgregarGastoLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="modalAgregarGastoLabel">
                        <i class="fas fa-plus-circle"></i> Agregar Nuevo Gasto
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarGasto">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="descripcion">
                                        <i class="fas fa-pen"></i> Descripción *
                                    </label>
                                    <input type="text" class="form-control" id="descripcion" name="descripcion"
                                        placeholder="Descripción del gasto" required>
                                    <small class="form-text text-muted">Ej: Compra de material de oficina</small>
                                </div>

                                <div class="form-group">
                                    <label for="monto">
                                        <i class="fas fa-dollar-sign"></i> Monto *
                                    </label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="number" class="form-control" id="monto" name="monto"
                                            placeholder="0.00" min="0" step="0.01" required>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="categoria">
                                        <i class="fas fa-tag"></i> Categoría *
                                    </label>
                                    <select class="form-control" id="categoria" name="categoria">
                                        <option value="">Seleccionar categoría</option>
                                        <option value="publicidad">publicidad</option>
                                        <option value="Mantener">Mantener</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="idProducto">
                                        <i class="fas fa-box"></i> Asociar a Producto *
                                    </label>
                                    <select class="form-control" id="idProducto" name="idProducto">
                                        <option value="">Seleccionar producto</option>
                                        <!-- Los productos se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <i class="fas fa-info-circle"></i>
                            <strong>Información:</strong> Los campos marcados con (*) son obligatorios.
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="limpiarFormularioGasto()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Guardar Gasto
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Actualizar Gasto -->
    <div class="modal fade" id="modalActualizarGasto" tabindex="-1" role="dialog"
        aria-labelledby="modalActualizarGastoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="modalActualizarGastoLabel">
                        <i class="fas fa-edit"></i> Actualizar Gasto
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formActualizarGasto">
                        <input type="hidden" id="idGastoActualizar" name="idGasto">

                        <div id="infoGastoActualizar" class="mb-3"></div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="descripcionActualizar">
                                        <i class="fas fa-pen"></i> Descripción *
                                    </label>
                                    <input type="text" class="form-control" id="descripcionActualizar"
                                        name="descripcion" placeholder="Descripción del gasto" required>
                                </div>

                                <div class="form-group">
                                    <label for="montoActualizar">
                                        <i class="fas fa-dollar-sign"></i> Monto *
                                    </label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="number" class="form-control" id="montoActualizar" name="monto"
                                            placeholder="0.00" min="0" step="0.01" required>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="categoriaActualizar">
                                        <i class="fas fa-tag"></i> Categoría *
                                    </label>
                                    <select class="form-control" id="categoriaActualizar" name="categoria">
                                        <option value="">Seleccionar categoría</option>
                                        <option value="publicidad">publicidad</option>
                                        <option value="Mantener">Mantener</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="idProductoActualizar">
                                        <i class="fas fa-box"></i> Asociar a Producto *
                                    </label>
                                    <select class="form-control" id="idProductoActualizar" name="idProducto">
                                        <option value="">Seleccionar producto</option>
                                        <!-- Los productos se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-3">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Importante:</strong> Los campos marcados con (*) son obligatorios.
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-warning" onclick="limpiarFormularioActualizarGasto()">
                                <i class="fas fa-undo"></i> Restablecer
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Actualizar Gasto
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Compra -->
    <div class="modal fade" id="modalAgregarCompra" tabindex="-1" role="dialog"
        aria-labelledby="modalAgregarCompraLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalAgregarCompraLabel">
                        <i class="fas fa-plus-circle"></i> Agregar Nueva Compra
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarCompra">
                        <!-- Información del Proveedor -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0" id="colorInformacionP"><i class="fas fa-building"></i> Información del
                                    Proveedor</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label for="idProveedor">
                                                <i class="fas fa-building"></i> Proveedor *
                                            </label>
                                            <select class="form-control" id="idProveedor" name="idProveedor" required>
                                                <option value="">Seleccionar proveedor...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox mt-4 pt-2">
                                                <input type="checkbox" class="custom-control-input"
                                                    id="aplicarRetefuente" name="aplicarRetefuente">
                                                <label class="custom-control-label" for="aplicarRetefuente">
                                                    <i class="fas fa-percentage"></i> Aplicar Retención en la Fuente
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productos -->
                        <div class="card mb-4">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h6 class="mb-0" id="colorInformacionP"><i class="fas fa-box"></i> Productos</h6>
                                <button type="button" class="btn btn-sm btn-success btn-agregar-producto">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="productosContainer">
                                    <!-- Los productos se agregarán dinámicamente aquí -->
                                </div>

                                <!-- Resumen de Totales -->
                                <div class="row mt-4">
                                    <div class="col-md-8"></div>
                                    <div class="col-md-4">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <strong>Subtotal:</strong>
                                                    <span class="subtotal-total">$0.00</span>
                                                </div>
                                                <div class="d-flex justify-content-between text-warning">
                                                    <strong>Retención:</strong>
                                                    <span class="retefuente-total">$0.00</span>
                                                </div>
                                                <hr>
                                                <div class="d-flex justify-content-between text-success">
                                                    <strong>Total a Pagar:</strong>
                                                    <span class="total-final font-weight-bold">$0.00</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Información:</strong> Los campos marcados con (*) son obligatorios.
                            La retención en la fuente se calculará automáticamente según el porcentaje configurado para
                            el proveedor.
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="limpiarFormularioAgregarCompra()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Guardar Compra
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Actualizar Compra -->
    <div class="modal fade" id="modalActualizarCompra" tabindex="-1" role="dialog"
        aria-labelledby="modalActualizarCompraLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="modalActualizarCompraLabel">
                        <i class="fas fa-edit"></i> Actualizar Compra
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formActualizarCompra">
                        <input type="hidden" id="idCompraActualizar" name="idCompra">

                        <!-- Información del Proveedor -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0" id="colorInformacionP"><i class="fas fa-building"></i> Información del
                                    Proveedor</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label for="idProveedorActualizar">
                                                <i class="fas fa-building"></i> Proveedor *
                                            </label>
                                            <select class="form-control" id="idProveedorActualizar" name="idProveedor"
                                                required>
                                                <option value="">Seleccionar proveedor...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox mt-4 pt-2">
                                                <input type="checkbox" class="custom-control-input"
                                                    id="aplicarRetefuenteActualizar" name="aplicarRetefuente">
                                                <label class="custom-control-label" for="aplicarRetefuenteActualizar">
                                                    <i class="fas fa-percentage"></i> Aplicar Retención en la Fuente
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productos -->
                        <div class="card mb-4">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h6 class="mb-0" id="colorInformacionP"><i class="fas fa-box"></i> Productos</h6>
                                <button type="button" class="btn btn-sm btn-success btn-agregar-producto"
                                    onclick="agregarLineaProducto('#productosContainerActualizar')">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="productosContainerActualizar">
                                    <!-- Los productos se agregarán dinámicamente aquí -->
                                </div>

                                <!-- Resumen de Totales -->
                                <div class="row mt-4">
                                    <div class="col-md-8"></div>
                                    <div class="col-md-4">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <strong>Subtotal:</strong>
                                                    <span class="subtotal-total">$0.00</span>
                                                </div>
                                                <div class="d-flex justify-content-between text-warning">
                                                    <strong>Retención:</strong>
                                                    <span class="retefuente-total">$0.00</span>
                                                </div>
                                                <hr>
                                                <div class="d-flex justify-content-between text-success">
                                                    <strong>Total a Pagar:</strong>
                                                    <span class="total-final font-weight-bold">$0.00</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Importante:</strong> Al actualizar una compra, el inventario se ajustará
                            automáticamente
                            restando las cantidades anteriores y sumando las nuevas.
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-warning" onclick="limpiarFormularioActualizarCompra()">
                                <i class="fas fa-undo"></i> Restablecer
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Actualizar Compra
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle de Compra -->
    <div class="modal fade" id="modalDetalleCompra" tabindex="-1" role="dialog"
        aria-labelledby="modalDetalleCompraLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalDetalleCompraLabel">
                        <i class="fas fa-receipt"></i> Detalle de Compra
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="contenidoDetalleCompra">
                    <!-- El contenido se cargará dinámicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    
     
    <!--Modal de proveedores-->
    <!-- Modal Agregar Proveedor -->
    <div class="modal fade" id="modalAgregarProveedor" tabindex="-1" role="dialog"
        aria-labelledby="modalAgregarProveedorLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalAgregarProveedorLabel">
                        <i class="fas fa-building"></i> Agregar Nuevo Proveedor
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarProveedor">
                        <div class="row">
                            <!-- Columna Izquierda -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nombre">
                                        <i class="fas fa-building"></i> Nombre de la Empresa *
                                    </label>
                                    <input type="text" class="form-control" id="nombre" name="nombre"
                                        placeholder="Ingrese el nombre de la empresa" required maxlength="255" />
                                    <small class="form-text text-muted">Nombre completo de la empresa proveedora</small>
                                </div>

                                <div class="form-group">
                                    <label for="nit">
                                        <i class="fas fa-id-card"></i> NIT *
                                    </label>
                                    <input type="text" class="form-control" id="nit" name="nit"
                                        placeholder="123456789-0" required maxlength="20" />
                                    <small class="form-text text-muted">Número de Identificación Tributaria</small>
                                </div>

                                <div class="form-group">
                                    <label for="telefono">
                                        <i class="fas fa-phone"></i> Teléfono *
                                    </label>
                                    <input type="tel" class="form-control" id="telefono" name="telefono"
                                        placeholder="+57 300 123 4567" required maxlength="20" />
                                    <small class="form-text text-muted">Número de contacto principal</small>
                                </div>
                            </div>

                            <!-- Columna Derecha -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="direccion">
                                        <i class="fas fa-map-marker-alt"></i> Dirección *
                                    </label>
                                    <textarea class="form-control" id="direccion" name="direccion" rows="3"
                                        placeholder="Ingrese la dirección completa..." required
                                        maxlength="500"></textarea>
                                    <small class="form-text text-muted">Dirección física de la empresa</small>
                                </div>

                                <div class="form-group">
                                    <label for="correo">
                                        <i class="fas fa-envelope"></i> Correo Electrónico *
                                    </label>
                                    <input type="email" class="form-control" id="correo" name="correo"
                                        placeholder="contacto@empresa.com" required maxlength="255" />
                                    <small class="form-text text-muted">Email de contacto principal</small>
                                </div>

                                <div class="form-group">
                                    <label for="porcentaje_retefuente">
                                        <i class="fas fa-percentage"></i> Porcentaje Retención en la Fuente
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="porcentaje_retefuente"
                                            name="porcentaje_retefuente" placeholder="0.00" min="0" max="100"
                                            step="0.01" />
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    <small class="form-text text-muted">Porcentaje de retención aplicable
                                        (opcional)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Información adicional -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Información:</strong> Los campos marcados con (*) son obligatorios.
                                    El porcentaje de retención en la fuente es opcional y debe estar entre 0 y 100.
                                </div>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="limpiarFormularioAgregarProveedor()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Guardar Proveedor
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Actualizar Proveedor -->
    <div class="modal fade" id="modalActualizarProveedor" tabindex="-1" role="dialog"
        aria-labelledby="modalActualizarProveedorLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="modalActualizarProveedorLabel">
                        <i class="fas fa-edit"></i> Actualizar Proveedor
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formActualizarProveedor">
                        <!-- Campo oculto para el ID del proveedor -->
                        <input type="hidden" id="idProveedorActualizar" name="idProveedor">

                        <div class="row">
                            <!-- Columna Izquierda -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nombreProveedorActualizar">
                                        <i class="fas fa-building"></i> Nombre de la Empresa *
                                    </label>
                                    <input type="text" class="form-control" id="nombreProveedorActualizar" name="nombre"
                                        placeholder="Ingrese el nombre de la empresa" required maxlength="255" />
                                    <small class="form-text text-muted">Nombre completo de la empresa proveedora</small>
                                </div>

                                <div class="form-group">
                                    <label for="nitActualizar">
                                        <i class="fas fa-id-card"></i> NIT *
                                    </label>
                                    <input type="text" class="form-control" id="nitActualizar" name="nit"
                                        placeholder="123456789-0" required maxlength="20" />
                                    <small class="form-text text-muted">Número de Identificación Tributaria</small>
                                </div>

                                <div class="form-group">
                                    <label for="telefonoActualizar">
                                        <i class="fas fa-phone"></i> Teléfono *
                                    </label>
                                    <input type="tel" class="form-control" id="telefonoActualizar" name="telefono"
                                        placeholder="+57 300 123 4567" required maxlength="20" />
                                    <small class="form-text text-muted">Número de contacto principal</small>
                                </div>
                            </div>

                            <!-- Columna Derecha -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="direccionActualizar">
                                        <i class="fas fa-map-marker-alt"></i> Dirección *
                                    </label>
                                    <textarea class="form-control" id="direccionActualizar" name="direccion" rows="3"
                                        placeholder="Ingrese la dirección completa..." required
                                        maxlength="500"></textarea>
                                    <small class="form-text text-muted">Dirección física de la empresa</small>
                                </div>

                                <div class="form-group">
                                    <label for="correoActualizar">
                                        <i class="fas fa-envelope"></i> Correo Electrónico *
                                    </label>
                                    <input type="email" class="form-control" id="correoActualizar" name="correo"
                                        placeholder="contacto@empresa.com" required maxlength="255" />
                                    <small class="form-text text-muted">Email de contacto principal</small>
                                </div>

                                <div class="form-group">
                                    <label for="porcentajeRetefuenteActualizar">
                                        <i class="fas fa-percentage"></i> Porcentaje Retención en la Fuente
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="porcentajeRetefuenteActualizar"
                                            name="porcentaje_retefuente" placeholder="0.00" min="0" max="100"
                                            step="0.01" />
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    <small class="form-text text-muted">Porcentaje de retención aplicable
                                        (opcional)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Información adicional -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Importante:</strong> Los campos marcados con (*) son obligatorios.
                                    Asegúrese de verificar que los datos sean correctos antes de guardar los cambios.
                                </div>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="form-actions">
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                                <button type="button" class="btn btn-warning btn-lg"
                                    onclick="limpiarFormularioActualizarProveedor()">
                                    <i class="fas fa-undo"></i> Restablecer
                                </button>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-save"></i> Actualizar Proveedor
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Estilos CSS para Compras -->
    <style>
        /* --- Estilos mejorados para el modal Detalle de Compra --- */
        .modal-content {
            max-width: 90vw;
            /* Que no ocupe todo el ancho de la pantalla */
            max-height: 85vh;
            /* Que no se pase del alto de la pantalla */
            overflow: hidden;
            /* Evita desbordamiento extraño */
            border-radius: 12px;
        }

        #colorInformacionP {
            color: black;
        }

        /* Contenido interno con scroll si es necesario */
        .modal-body {
            max-height: 65vh;
            /* El body tendrá scroll cuando el contenido crezca */
            overflow-y: auto;
            padding: 1.5rem;
        }

        /* Encabezado fijo arriba */
        .modal-header {
            cursor: move;
            /* Indicador para que el usuario sepa que puede arrastrar */
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        /* Hacer más legible el footer */
        .modal-footer {
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            border-radius: 0 0 12px 12px;
        }

        /* Tabla con scroll horizontal si hay muchos productos */
        .table-responsive {
            overflow-x: auto;
        }

        /* Estilos para la sección de compras */
        .compras-header {
            margin-bottom: 2rem;
        }

        .compras-actions {
            display: flex;
            gap: 1rem;
        }

        .estadisticas-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 2rem;
            color: white;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-card.bg-primary {
            background: linear-gradient(135deg, #4e73df, #2e59d9);
        }

        .stat-card.bg-success {
            background: linear-gradient(135deg, #1cc88a, #17a673);
        }

        .stat-card.bg-info {
            background: linear-gradient(135deg, #36b9cc, #2c9faf);
        }

        .stat-card.bg-warning {
            background: linear-gradient(135deg, #f6c23e, #dda20a);
        }

        .stat-card .stat-icon {
            font-size: 2.5rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .stat-card .stat-info h4 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-card .stat-info p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .stat-card-small {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .filtros-compras {
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .filtros-compras .card-title {
            color: #667eea;
            font-weight: 600;
        }

        .compras-table {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .compras-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .compras-table .compra-row {
            transition: all 0.2s ease;
        }

        .compras-table .compra-row:hover {
            background-color: #f8f9fc;
            transform: translateX(5px);
        }

        .proveedor-info strong {
            color: #5a5c69;
        }

        .monto-total {
            color: #1cc88a;
            font-size: 1.1rem;
        }

        .monto-subtotal {
            color: #36b9cc;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        .action-buttons .btn {
            transition: all 0.2s ease;
        }

        .action-buttons .btn:hover {
            transform: scale(1.1);
        }

        /* Estilos para los modales de compra */
        .producto-linea {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .producto-linea:hover {
            border-color: #667eea;
            background: #f0f1ff;
        }

        .producto-info {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .subtotal-display {
            font-weight: bold;
            color: #28a745;
            text-align: right;
        }

        /* Animación para agregar productos */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .producto-linea {
            animation: fadeInUp 0.3s ease-out;
        }

        /* Botones personalizados */
        .btn-agregar-producto {
            transition: all 0.2s ease;
        }

        .btn-agregar-producto:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .estadisticas-container {
                padding: 1rem;
            }

            .stat-card {
                margin-bottom: 0.5rem;
            }

            .stat-card .stat-info h4 {
                font-size: 1.5rem;
            }

            .compras-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-wrap: wrap;
            }

            .producto-linea .row>div {
                margin-bottom: 1rem;
            }
        }

        /* Estilos para el detalle de compra */
        .current-image {
            max-width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .preview-image {
            max-width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Mejoras visuales para la tabla */
        .no-data {
            padding: 3rem;
            color: #6c757d;
        }

        .no-data i {
            opacity: 0.5;
        }

        /* Paginación personalizada */
        .pagination .page-link {
            color: #667eea;
            border-color: #dee2e6;
        }

        .pagination .page-item.active .page-link {
            background-color: #667eea;
            border-color: #667eea;
        }

        .pagination .page-link:hover {
            color: #5a67d8;
            background-color: #e3f2fd;
            border-color: #bbdefb;
        }

        /* Loading spinner */
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Badges personalizados */
        .badge-success {
            background-color: #1cc88a !important;
        }

        .badge-warning {
            background-color: #f6c23e !important;
        }

        .badge-danger {
            background-color: #e74a3b !important;
        }

        .badge-primary {
            background-color: #4e73df !important;
        }

        /* Efectos de hover para tarjetas */
        .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
    </style>
 

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
    <script type="module" src="js/Admin/productosAdmin.js"></script>
    <script type="module" src="js/pedidos.js"></script>
    <script type="module" src="js/pagos.js"></script>
    <script type="module" src="js/ventas.js"></script>
    <script type="module" src="js/proveedor.js"></script>
    <script type="module" src="js/gastos.js"></script>
    <script type="module" src="js/compras.js"></script>
    <script type="module" src="js/crm.js"></script>

    <script>
        $(document).ready(function () {
            // Verificar sesión de administrador
            const idUsuario = sessionStorage.getItem("idUsuario");
            const role = sessionStorage.getItem("rol");

            if (!idUsuario || role !== "admin") {
                alert("Debes iniciar sesión como administrador para acceder a esta página.");
                window.location.href = "login.html";
            }

            // Manejar clic en botón de cerrar sesión
            $("#btnCerrarSesion").click(function (e) {
                e.preventDefault();
                if (confirm("¿Estás seguro de que quieres cerrar sesión?")) {
                    sessionStorage.clear();
                    window.location.href = "login.html";
                }
            });

            // Mostrar/ocultar campo empresa según el rol seleccionado
            $('#rol').on('change', function() {
                const rol = $(this).val();
                if (rol === 'empresa' || rol === 'empleado') {
                    $('#grupoEmpresa').slideDown();
                    $('#empresa_trabaja').prop('required', true);
                } else {
                    $('#grupoEmpresa').slideUp();
                    $('#empresa_trabaja').prop('required', false);
                    $('#empresa_trabaja').val('');
                }
            });

            // Manejar navegación entre secciones
            $('.sidebar a[href^="#"]').click(function (e) {
                e.preventDefault();
                const target = $(this).attr('href');

                // Ocultar todas las secciones
                $('.seccion-content').hide();

                // Mostrar la sección seleccionada
                $(target).show();

                // Actualizar clase activa en sidebar
                $('.sidebar a').removeClass('active');
                $(this).addClass('active');

                // Guardar última sección en localStorage
                localStorage.setItem('ultimaSeccion', target);

                // Cargar datos específicos según la sección
                if (target === '#usuarios') {
                    cargarUsuarios();
                } else if (target === '#casos-soporte') {
                    cargarCasosSoporte();
                } else if (target === '#actividades') {
                    cargarActividades();
                } else if (target === '#oportunidades') {
                    cargarOportunidades();
                } else if (target === '#interacciones') {
                    cargarInteracciones();
                } else if (target === '#metricas-crm') {
                    cargarMetricasCRM();
                }else if (target === '#gastos') {
                        cargarGastos(); // Esto debería ejecutarse siempre al hacer clic en Gastos
                }
            });

            // Restaurar sección activa al recargar
            const ultimaSeccion = localStorage.getItem('ultimaSeccion');
            if (ultimaSeccion && $(ultimaSeccion).length > 0) {
                $('.seccion-content').hide();
                $(ultimaSeccion).show();
                $('.sidebar a').removeClass('active');
                $(`.sidebar a[href="${ultimaSeccion}"]`).addClass('active');

                // Cargar datos de la sección
                if (ultimaSeccion === '#usuarios') {
                    cargarUsuarios();
                } else if (ultimaSeccion === '#casos-soporte') {
                    cargarCasosSoporte();
                } else if (ultimaSeccion === '#actividades') {
                    cargarActividades();
                } else if (ultimaSeccion === '#oportunidades') {
                    cargarOportunidades();
                } else if (ultimaSeccion === '#interacciones') {
                    cargarInteracciones();
                } else if (ultimaSeccion === '#metricas-crm') {
                    cargarMetricasCRM();
                }
            } else {
                // Mostrar productos por defecto
                $('#productos').show();
                $('.sidebar a[href="#productos"]').addClass('active');
            }
        });
    </script>
</body>
</html>





